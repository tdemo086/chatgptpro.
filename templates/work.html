@app.route('/task/<task_id>', methods=['POST'])
def complete_task(task_id):
    if 'logged_in' not in session:
        return jsonify({'success': False, 'message': 'User not logged in'}), 403

    user = session['user']
    user_id = user['id']  # Ensure you have user ID in session
    points_earned = 50

    try:
        # Update user points in Firebase
        ref = db.reference(f'users/{user_id}')
        user_data = ref.get()

        if user_data:
            current_points = user_data.get('points', 0)
            updated_points = current_points + points_earned

            ref.update({
                'points': updated_points
            })

            # Update the session data
            session['user']['points'] = updated_points

            return jsonify({'success': True, 'points': updated_points})
        else:
            return jsonify({'success': False, 'message': 'User not found'}), 404
    except Exception as e:
        return jsonify({'success': False, 'message': str(e)}), 500
